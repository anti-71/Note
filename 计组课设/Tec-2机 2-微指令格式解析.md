# tec-2机 2-微指令格式解析

每条微指令由56位组成，从高向低各位标记为$B55-B0$，分为13个字段

## $B55-B46$

该10位微码的是下地址字段

## $B44,B45,B35$

备用

## $B43-40$

为$CI3-1$，用于给出`AM2910`的16种命令码编号

**`AM2910`命令表**

|      | 完成功能      | R/C 内容 | R/C 操作 | 使能信号 | $\overline{CCEN}$ |      |                   |      |
| ---- | ------------- | -------- | -------- | -------- | ----------------- | ---- | ----------------- | ---- |
|      |               |          |          |          | $\overline{CC}$高 |      | $\overline{CC}$低 |      |
|      |               |          |          |          | Y 输出            | 堆栈 | Y 输出            | 堆栈 |
| 0    | 初始化        |          |          | PL       | 0                 | 清除 | 0                 | 清除 |
| 1    | 条件转微子    |          |          | PL       | $\mu$PC           |      | D                 | 压入 |
| 2    | 指令功能分支  |          |          | MAP      | D                 |      | D                 |      |
| 3    | 条件转移      |          |          | PL       | $\mu$PC           |      | D                 |      |
| 4    | 入栈 R/C 装数 |          | 注 1     | PL       | $\mu$PC           | 压入 | $\mu$PC           | 压入 |
| 6    | 转中断向量    |          |          | VECT     | $\mu$PC           |      | D                 |      |
| 8    | R/C 非零循环  | 非零     | -1       | PL       | F                 |      | F                 |      |
|      |               | 零       |          | PL       | $\mu$PC           | 弹出 | $\mu$PC           | 弹出 |
| 10   | 条件返回      |          |          | PL       |                   |      | F                 | 弹出 |
| 14   | 顺序执行      |          |          | PL       |                   |      | $\mu$PC           |      |
| 15   | 三路转移      | 非零     | -1       | PL       | F                 |      | $\mu$PC           |      |
|      |               | 零       |          | PL       | D                 | 弹出 | $\mu$PC           | 弹出 |

> 注 1：$\overline{CC}$为高，$R/C$保持；$\overline{CC}$为低，$R/C$装数
>
> 注 2：$R/C$操作栏为空，则保持；堆栈栏为空，则保持
>
> 注 3：$μPC$：微指令寄存器 $D$：外部输入，由使能信号$/PL$、$/MAP$ 和$/VECT$决定其来源
>
> 注 4：$R/C$：寄存器/计数器 $F$：微堆栈栈顶
>
> 注 5：$Y$输出就是`Am2910`提供的后继微地址
> 当$Y$输出是$D$时，由使能信号（$PL/MAP/VECT$）决定$D$的来源（$PL$：微指令的下址字段，$MAP$：指令译码器的输出，$VECT$：手拨微地址）

**0 号命令**: 用于初始化，即无条件清除内部微堆栈，并使$Y $的输出一定为零，用于系统加电时， 确保此时系统从 0 号微地址开始执行微程序

**2 号命令**: 用于指令功能分支，即输出信号$/MAP $为低,使 D 输入信号从$ MAP\ ROM$（微地址映射部件）得到，并将其作为输出微地址$ Y $的值，实现用指令操作码找到对应该指令的微程序段的入口地址，从而开始该条指令的特定的执行过程

**3 号命令**: 用于条件微转移控制，当条件成立，即$/CC $为低时，用$/PL $把微指令字中的下地址字段的内容(转移地址)经过$ D $输入并送到$ Y$，实现微程序转移

当/CC 为高时，微程序顺序执行，即把已增 1 后的微指令地址作为下地址

若外部电路确保送入的$/CC $的状态为低，3 号条件微转移命令也可以用于实现无条件的必定微程序转移来使用

**4 号命令**: 进栈并条件装入计数器，把下条微指令的地址压入堆栈中，同时若条件测试通过，则把当前微指令地址字段的内容(通常作为循环次数)装入计数器中，然后顺序执行。该命令通常是为建立微程序循环作准备

**6 号命令**：条件转至中断向量，用于为外部输入$ D $选择一个新的微地址来源，即输出信号$/VECT $为低，原意取某一向量地址，我们用其从教学机主板上的开关取一个手拨的微程序地址

**8 号命令**: 用于微程序循环控制

为了使用这条命令，前面必须用一条命令(通常是 4 号命令)把循环首地址压入堆栈，把循环次数装入计数器

该命令执行时，先检测计数器的值是否为零，若不为零，则计数器减一，并取微栈顶的内容作为下条微指令的地址(即继续循环)，否则，把微堆栈指针减一(即弹出循环地址)，顺序执行下一条微指令

**14 号命令**：顺序执行，即执行紧跟在本条微指令后面的那条微指令

**15 号命令**: 三路转移，与 8 号命令类似，在该命令执行之前，前面必须有一命令(如 4 号命令)已把转移地址压入堆栈，把循环计数值装入计数器

该命令要同时受到条件输入和计数器当前值的控制

当计数器不为零时，计数器减一，同时，若条件测试通过，则退栈(即弹出转移地址)，并选择增 1 后的微指令地址作为下条微指令的地址，否则，选择微栈顶的内容作为下条微指令的地址；

 当计数器为零时，微堆栈指针减一(即退栈)，此时，若条件测试通过，则用增 1 后的微指令地址为下条微指令的地址，否则，下地址来自当前微指令的下地址字段

## $B39-B37、B36$

3位$SCC$和1位$SC$，用于给出`AM2910`的条件判断信号/$CC$的选择码

**`AM2910`条件码**

|      | SCC                    | CC                                          |
| ---- | ---------------------- | ------------------------------------------- |
| 0    |                        | 0                                           |
| 1    |                        | 1                                           |
| 2    | SC=0                   | /FS₁                                        |
| 3    | SC=0                   | /FS₂                                        |
| 4    | SC=0                   | /FS₃                                        |
| 5    | SC=0                   | /WAIT                                       |
| 2    | SC=1                   | /C                                          |
| 3    | SC=1                   | /Z                                          |
| 4    | SC=1                   | /V                                          |
| 5    | SC=1                   | /S                                          |
| 6    | SC=1                   | /INT                                        |
| 7    | IR₁₀₋₈（0 - 7 对应行） | 0: /C 1: /Z 2: /V 3: /S 4: C 5: Z 6: V 7: S |

## $B34-B32$

控制标志寄存器写入的$SST$

**状态位产生**

| SST  | C    | Z    | V    | S    |
| ---- | ---- | ---- | ---- | ---- |
| 0    | C    | Z    | V    | S    |
| 1    | CY   | ZR   | OV   | F3   |
| 2    | IB₇  | IB₆  | IB₅  | IB₄  |
| 3    | 0    | Z    | V    | S    |
| 4    | 1    | Z    | V    | S    |
| 5    | RAM₀ | Z    | V    | S    |
| 6    | RAM₃ | Z    | V    | S    |
| 7    | Q0   | Z    | V    | S    |

## $B31,B27,B23$

用于控制内存的读写、外设接口的读写、微指令的装入

| /MIO | REQ  | /WE  | 操作功能 |
| ---- | ---- | ---- | -------- |
| 0    | 0    | 0    | 存储器写 |
| 0    | 0    | 1    | 存储器读 |
| 0    | 1    | 0    | I/O 写   |
| 0    | 1    | 1    | I/O 读   |
| 1    | 0    | X    | 不操作   |
| 1    | 1    | X    | 装入微码 |

## $B30-B28,B26-B24,B22-B20$

$MI_{8-0}$字段，给出`AM2901`运算器芯片的3组9个控制信号

|       | I8-6           |            | I5-3         | I2-0 |      |
| ----- | -------------- | ---------- | ------------ | ---- | ---- |
| 0 0 0 | F→Q            | F          | R+S          | A    | Q    |
| 0 0 1 | 无             | F          | S-R          | A    | B    |
| 0 1 0 | F→B            | A          | R-S          | 0    | Q    |
| 0 1 1 | F→B            | F          | R∨S          | 0    | B    |
| 1 0 0 | F/2→B Q/2→Q    | F          | R∧S          | 0    | A    |
| 1 0 1 | F/2→B          | F          | ¬R∧S         | D    | A    |
| 1 1 0 | 2F→B 2Q→Q      | F          | R⊕S          | D    | Q    |
| 1 1 1 | 2F→B           | F          | R⊙S          | D    | 0    |
|       | 寄存器结果选择 | Y 输出选择 | 运算功能选择 | R    | S    |

## $B19-B16,B15-B12$

$A$口、$B$口字段，给出`AM2901`运算器芯片的寄存器组内通过$A$口和$B$口访问的寄存器地址

$R_3-R_0 $和$ R_{15}-R_8 $作为通用寄存器使用，由指令中的源寄存器和目的寄存器字段给出要访问的寄存器地址；

$R_7-R_4$作为专用寄存器，不能由指令通过寄存器地址直接访问，只能用送入的$ A $口地址和$ B $口地址指定访问

| 寄存器 | 功能描述                           |
| ------ | ---------------------------------- |
| R₄     | SP，栈顶指针                       |
| R₅     | PC，增量后的指令地址（程序计数器） |
| R₆     | IP，当前执行指令的地址             |
| R₇     | 单步专用                           |

## $B11-B10$

最低位进位控制$SCi$

**`AM2910`最低位进位**

| SCi  | Cin      |
| ---- | -------- |
| 0    | 0        |
| 1    | 1        |
| 2    | C        |
| 3    | TCLK方波 |

## $B9-B8$

移位信号形成$SSH$

**移位控制**

|      | 左移 |                        | 右移                                                   |      |
| ---- | ---- | ---------------------- | ------------------------------------------------------ | ---- |
| SSH  | RAM₀ | Q0                     | MAM₃                                                   | Q3   |
| 0    | 0    | X                      | 0                                                      | X    |
| 1    | C    | X                      | C                                                      | X    |
| 2    | Q₃   | $\overline{\text{F3}}$ | CY                                                     | RAM  |
| 3    | X    | X                      | $\begin{array}{c}\text{F3} \\ \text{或 OV}\end{array}$ | RAM  |

## $B7,B3$

$SA$、$SB$字段：选择$A$口和$B$口寄存器地址的来源

| SA=0 作 Am2901 | SB=0 作 Am2901 |
| -------------- | -------------- |
| A 口地址       | B 口地址       |
| SA=1 用 IR₃₋₀  | SB=1 用 IR₇₋₄  |

## $B6-B4$

$DC1$字段，指定送往内部总线$IB$的数据来源

| DC1 编码 | 控制端              | 送往内部总线 IB 的数据 |
| -------- | ------------------- | ---------------------- |
| 0 0 0    | $\overline{SWTOIB}$ | 开关手拨数据           |
| 0 0 1    | $\overline{RTOIB}$  | 运算器的输出           |
| 0 1 0    | $\overline{ITOIB}$  | 指令的低 8 位          |
| 0 1 1    | $\overline{FTOIB}$  | 状态寄存器             |
| 1 0 0    | $\overline{INTA}$   | 中断向量               |
| 1 0 1    | NC                  | 未使用                 |
| 1 1 0    | $\overline{EI}$     | 转用于开中断           |
| 1 1 1    | $\overline{DI}$     | 转用于开中断           |

## $B2-B0$

$DC2$字段：指定接收来自内部总线$IB$的数据的寄存器

| DC2 编码 | 控制端             | 寄存器接收来自 IB 的数据 |
| -------- | ------------------ | ------------------------ |
| 0 0 0    | NC                 | 未使用（NC）             |
| 0 0 1    | $\overline{GIR}$   | 指令寄存器 IR            |
| 0 1 0    | $\overline{GAR}$   | 地址寄存器 AR            |
| 0 1 1    | $\overline{GINTP}$ | 中断优先权               |
| 1 0 0    | CPLDR0             | LDR6                     |
| 1 0 1    | CPLDR1             | LDR5，LDR4               |
| 1 1 0    | CPLDR2             | LDR3，LDR2               |
| 1 1 1    | CPLDR3             | LDR1，LDR0               |