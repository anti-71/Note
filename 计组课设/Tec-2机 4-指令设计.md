# Tec-2机 4-指令设计

## 第二题

### 题目：

把立即数$DATA$传输至地址为$ADDR$的内存单元中保存

指令格式：`D8××，ADDR，DATA`，  三字指令（控存入口110H）

功能：  `[ADDR]=DATA`

### 设计思路

该指令为三字指令，类似于实验一，需要先取出第二个地址中的内容，并储存回第一个地址位置

由此可见第一个地址直至最后都需要使用到，为了增加效率，可以先将第二个操作数取出储存至Q寄存器，再取用第一个地址

### 微指令流程图

<img src="D:\Note\计组课设\Assets\流程图2.jpeg" style="zoom:50%;" />

**流程图中的缩写含义**：

> PC: Program Counter (程序计数器)
>
> AR: Address Register (地址寄存器)
>
> MEM: Memory (当出现MEM的时候，就是在对"AR"存的地址取值)
>
> AR相当于"指针"，MEM相当于"值"
>
> Q: Q Register (用来计算的)

### 微指令详细设计

| 序号 | 微指令功能                 | 微指令代码          | 详细功能                           |
| ---- | -------------------------- | ------------------- | ---------------------------------- |
| 1    | $PC + 1 \to AR$            | 0000 0E00 90B5 5402 | 为 AR 读入第二个操作数的地址做准备 |
| 2    | $MEM \to Q$                | 0000 0E00 00F0 0000 | 读第二个操作数并送 Q 寄存器        |
| 3    | $PC \to AR, PC + 1 \to PC$ | 0000 0E00 A0B5 5402 | 为 AR 读入第一个操作数的地址做准备 |
| 4    | $MEM \to AR$               | 0000 0E00 10F0 0002 | AR 读入第一个操作数的地址          |
| 5    | $Q \to MEM, CC\#=0$        | 0029 0300 1020 0010 | Q 寄存器结果送回第一个操作数位置   |

### 分析

对比第一题，其实第二题就是把第一题的第2、6条去掉了

首先，第一题和第二题的共同点都是要把数据最后存回ADDR中

区别在于，第一题和第二题的第一步指令虽然功能都是$PC+1→AR$，但是在第一题中，读入的是`ADDR1`的地址，第二题中读入的是`DATA`的地址

也就是说，在第一题中对`AR`取值后取出来的是**另一个地址**，第二题取出来的直接就是**要用的数字**了

即：第一题中是指针的指针，第二题只是一个指针，取一层就出来值了

所以，在第二题中，指令 2 直接可以$MEM→Q$，因为$MEM$(也就是对`AR`取值)就是立即数`DATA`了，而第一题你需要再加一条$MEM→AR$，这样才**把`ADDR1`的地址取出来**，再执行$MEM→Q$才是**把`ADDR1`里的东西取出来**

第二题去掉第一题的第6条单纯是因为不需要运算了，直接送回就完事了

## 第三题
### 题目：
转移指令，判断两个通用寄存器的内容是否相等，若不相等则转移到指定的目的地址，否则顺序执行

指令格式：`E1 DR SR，ADDR`   单字指令（控存入口130H）

功能：    `if DR!=SR go to ADDR else 顺序执行`

### 设计思路
该指令为二字指令，第一步让$SR-DR$，把结果是否为零的信息记录在标志位，接着根据标志位`Z#`来条件跳转

等于 1，说明两个数不相等，微程序跳转，取出需要跳转的位置位置至`PC`

反之，顺序执行

### 微指令流程图

<img src="D:\Note\计组课设\Assets\流程图3.jpeg" style="zoom:50%;" />

> SR,DR: 通用寄存器，Tec-2 共有16个寄存器，部分有专属功能，部分为通用寄存器
>
> PC: Program Counter (程序计数器)
>
> AR: Address Register (地址寄存器)
>
> MEM: Memory (当出现MEM的时候，就是在对"AR"存的地址取值)
>
> AR相当于"指针"，MEM相当于"值"
>
> (CC)#: 条件码
>
> Z#：条件码

### 微指令详细设计

| 序号 | 微指令功能             | 微指令代码          | 详细功能                                            |
| ---- | ---------------------- | ------------------- | --------------------------------------------------- |
| 1    | SR-DR                  | 0000 0E01 9190 0088 | 通过 SR-DR 改变 Z 状态值                            |
| 2    | PC→AR PC+1→PC (CC)#=Z# | 0029 03E0 A0B5 5402 | 为顺序执行做准备 并通过判断 Z 状态值判断 是否要跳转 |
| 3    | MEM→PC (CC)#=0         | 0029 0300 30F0 5000 | 跳转                                                |

### 逐条分析

#### 序号 1

```
SR-DR
0000 0E01 9190 0088
```

![](D:\Note\计组课设\Assets\Instruction8.png)

| 位范围      | 字段名          | 功能描述                                |
| ----------- | --------------- | --------------------------------------- |
| B55 - B46   | 下地址字段      | 顺序执行时，下地址段任意                |
| B45 - B44   | 备用            | 备用位任意                              |
| B43 - B40   | CI3~CI0         | **顺序执行**                            |
| B39 - B37   | SCC             | 任意                                    |
| B36         | SC              | 任意                                    |
| B35         | 备用            | 备用位任意                              |
| B34 - B32   | SST             | **接受 ALU 标志位输出值**               |
| B31,B27,B23 | /MIO、/REQ、/WE | **不操作**                              |
| B30 - B28   | MI8 - 6         | **运算器 Y 输出送 F 口**                |
| B26 - B24   | MI5 - 3         | **运算功能选择为 “S - R”**              |
| B22 - B20   | MI2 - 0         | **Am2901 的运算数来源选择 A 口和 B 口** |
| B19 - B16   | A 口            | 未用，任意                              |
| B15 - B12   | B 口            | 未用，任意                              |
| B11 - B10   | SCi             | 进位为 0                                |
| B9 - B8     | SSH             | 无需移位                                |
| B7          | SA              | **指令给 R 赋值**                       |
| B6 - B4     | DC1             | 未向总线发送控制，可任意                |
| B3          | SB              | **指令给 S 赋值**                       |
| B2 - B0     | DC2             | 未使用                                  |

#### 序号 2

```
PC→AR PC+1→PC (CC)#=Z#
0029 03E0 A0B5 5402
```

![](D:\Note\计组课设\Assets\Instruction9.png)

| 位范围      | 字段名          | 功能描述                                   |
| ----------- | --------------- | ------------------------------------------ |
| B55 - B46   | 下地址字段      | **跳转执行，下地址段为 A4，进行中断检测**  |
| B45 - B44   | 备用            | 备用位任意                                 |
| B43 - B40   | CI3~CI0         | **条件转移**                               |
| B39 - B37   | SCC             | **判断**                                   |
| B36         | SC              | 任意                                       |
| B35         | 备用            | 备用位任意                                 |
| B34 - B32   | SST             | 不是运算，任意即可                         |
| B31,B27,B23 | /MIO、/REQ、/WE | **不操作**                                 |
| B30 - B28   | MI8 - 6         | **运算器 Y 输出送 A 口，寄存器结果送回 B** |
| B26 - B24   | MI5 - 3         | **运算功能选择为 “R + S”**                 |
| B22 - B20   | MI2 - 0         | **Am2901 的运算数来源选择 0 和 B**         |
| B19 - B16   | A 口            | **R5(PC)**                                 |
| B15 - B12   | B 口            | **R5(PC)**                                 |
| B11 - B10   | SCi             | **进位设置为 1 (实现 PC + 1)**             |
| B9 - B8     | SSH             | 无需移位                                   |
| B7          | SA              | 选择 A 口地址                              |
| B6 - B4     | DC1             | 未使用                                     |
| B3          | SB              | 选择 B 口地址                              |
| B2 - B0     | DC2             | **运算器输出送 AR，选 / GAR**              |

#### 序号 3

```
MEM→PC (CC)#=0
0029 0300 30F0 5000
```

![](D:\Note\计组课设\Assets\Instruction10.png)

| 位范围      | 字段名          | 功能描述                                    |
| ----------- | --------------- | ------------------------------------------- |
| B55 - B46   | 下地址字段      | **跳转执行，下地址段为 A4，进行中断检测**   |
| B45 - B44   | 备用            | 备用位任意                                  |
| B43 - B40   | CI3~CI0         | **条件转移**                                |
| B39 - B37   | SCC             | 任意                                        |
| B36         | SC              | 任意                                        |
| B35         | 备用            | 备用位任意                                  |
| B34 - B32   | SST             | 不是运算，任意即可                          |
| B31,B27,B23 | /MIO、/REQ、/WE | **储存器读取**                              |
| B30 - B28   | MI8-6           | **运算器 Y 输出送 F 口，寄存器输出 F 至 B** |
| B26 - B24   | MI5-3           | **运算功能选择为 “R+S”**                    |
| B22 - B20   | MI2-0           | **Am2901 的运算数来源选择 D 和 0**          |
| B19 - B16   | A 口            | 未用，任意                                  |
| B15 - B12   | B 口            | R5(PC)                                      |
| B11 - B10   | SCi             | 进位为 0                                    |
| B9 - B8     | SSH             | 无需移位                                    |
| B7          | SA              | 选择 A 口地址                               |
| B6 - B4     | DC1             | 未使用                                      |
| B3          | SB              | 选择 B 口地址                               |
| B2 - B0     | DC2             | 未使用                                      |